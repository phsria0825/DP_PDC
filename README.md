N개 교차로 연비 최적 주행 시스템 아키텍처 설계 명세서문서 버전: 1.3작성일: 2025년 10월 3일1. 개요1.1. 목적본 문서는 N개의 신호 교차로가 포함된 경로를 주행하는 차량의 연비를 극대화하기 위한 실시간 속도 계획 시스템의 아키텍처를 정의하는 것을 목적으로 한다. 시스템은 동적인 교통 상황(신호 정보)에 적응하며, 계산 부하를 실시간 처리 가능한 수준으로 유지하는 데 중점을 둔다.1.2. 핵심 전략: 롤링 호라이즌 컨트롤 (Rolling Horizon Control, RHC)전체 N개 교차로 구간을 한 번에 최적화하는 것은 '차원의 저주(Curse of Dimensionality)'로 인해 실시간 적용이 불가능하다. 이를 해결하기 위해 본 시스템은 롤링 호라이즌 컨트롤(RHC) 전략을 채택한다.예측 구간 (Prediction Horizon): 현재 시점에서 가장 가까운 **2개의 교차로(K, K+1)**만을 대상으로 최적화를 수행한다.제어 구간 (Control Horizon): 계산된 최적 궤적 중 첫 번째 구간(현재 위치 → K)의 계획만을 실제 차량 제어에 적용한다.호라이즌 이동 (Rolling): 차량이 K 교차로를 통과하면, 예측 구간을 한 단계 앞으로 이동시켜 **(K+1, K+2)**에 대한 재최적화를 수행한다. 이 과정을 통해 오차를 보정하고 새로운 정보에 지속적으로 적응한다.1.3. 시스템 아키텍처시스템은 계층적 구조를 가지며, 상위 제어기가 전체 프로세스를 총괄하고 하위 모듈이 특정 계산을 수행한다.graph TD
    subgraph 차량 외부 데이터
        A[V2I 통신<br>(실시간 신호 정보 - SPaT)]
        B[지도 데이터<br>(교차로 위치, 경사도, 신호주기)]
    end
    
    subgraph 차량 내부 데이터
        C[차량 센서<br>(현재 속도, 누적 이동 거리)]
    end

    subgraph "상위 제어기 (RHC Supervisor)"
        D(<b>RHC Supervisor</b><br>MATLAB Function 블록)
        D -- 1. 경로 관리 --> E{교차로 큐 (IQ)<br>Persistent}
        D -- 2. 호라이즌 관리 --> F(현재 K, K+1 결정)
        D -- 3. 데이터 준비 --> G{최적화 버퍼 (OB)<br>d1,d2,d3,SPaT}
        D -- 4. 모듈 호출 --> H(<b>신호 스케줄러</b><br>fcn_stateless)
        D -- 5. 모듈 호출 --> I(<b>DP 최적화 엔진</b><br>velocityOptimiz_DP)
    end
    
    subgraph "하위 계산 모듈"
        I -- 비용 계산 시 호출 --> K(<b>연비 예측 모델</b><br>fuel_prediction_model)
    end
    
    subgraph 하위 제어기
        J[차량 동력계 제어기<br>(ACC, Powertrain)]
    end

    A & B & C --> D
    H --> I
    I --> D
    D -- 최종 목표 속도 (v_set) --> J
1.4. 개발 및 실행 환경본 시스템은 MATLAB R2022b 버전 및 Simulink 환경에서 개발 및 시뮬레이션되는 것을 표준으로 한다. 모든 기능 블록과 로직은 해당 버전과의 호환성을 보장해야 한다.2. 주요 구성 요소 상세2.1. 상위 제어기 (RHC Supervisor)시스템의 두뇌 역할을 하는 핵심 구성 요소. Simulink 내 단일 MATLAB Function 블록으로 구현된다.역할:경로 관리: 전체 N개 교차로 경로 정보를 persistent 큐(Queue)에 저장하고 관리한다.호라이즌 제어: 차량의 현재 위치를 기반으로 목표 교차로(K)를 동적으로 업데이트하고 예측 구간을 이동(Rolling)시킨다.데이터 준비: 현재 예측 구간(K, K+1)에 필요한 모든 정적/동적 데이터를 수집하고 가공하여 하위 모듈의 입력 형식에 맞게 최적화 버퍼를 구성한다.모듈 실행: 신호 스케줄러와 DP 최적화 엔진을 적시에 호출하고 결과를 수신한다.궤적 생성: 최종 최적화 결과를 바탕으로 실시간 목표 속도(v_set)를 생성하여 하위 제어기에 전달한다.2.2. DP 최적화 엔진 (velocityOptimiz_DP)2개 교차로 구간에 대한 연비 최적 속도 프로파일을 계산하는 순수 계산 모듈.역할: RHC Supervisor로부터 전달받은 최적화 버퍼의 데이터를 기반으로, (K, K+1) 구간을 통과하는 총 연료 소모량을 최소화하는 궤적을 DP 기법으로 탐색한다. 이때 비용 함수(Cost Function)로는 2.4절에 명시된 연비 예측 모델을 사용한다.특징:상태적(Stateful): 제어 영역(Control Zone) 진입 여부, 최적화 완료 여부 등 자신의 상태를 persistent 변수(ST)를 통해 독립적으로 관리한다.모듈성: 입력과 출력이 명확하여 다른 상위 제어기에서도 재사용이 가능하다.2.3. 신호 스케줄러 (fcn_stateless)RHC 환경에 맞게 수정된 상태 없는(Stateless) 순수 계산 함수.역할: RHC Supervisor로부터 현재 예측 구간에 해당하는 교차로(K, K+1)의 초기 신호 상태와 주기를 전달받아, 미래의 신호 변경 시점(trfTime)을 계산하여 반환한다.특징: persistent 변수가 없어 상태를 저장하지 않으므로, RHC의 롤링 과정에서 발생할 수 있는 상태 불일치 문제를 원천적으로 방지한다.2.4. 연비 예측 모델 (fuel_prediction_model)DP 최적화 엔진의 비용 함수로 사용되는 핵심 계산 모듈.2.4.1. 역할 및 위치차량의 현재 속도(v), 가속도(a), 도로 경사도(theta)를 기반으로 순간 연료 소모율(FC)을 계산한다. DP 최적화 엔진은 탐색하는 모든 가능한 속도 프로파일에 대해 이 모델을 호출하고, 계산된 연료 소모율을 시간에 대해 적분하여 총 연료 소모량을 산출한다.2.4.2. 구현 코드시스템에 적용될 연비 예측 모델의 MATLAB 코드는 다음과 같다.function FC = fuel_prediction_model(v, a, theta)
% FuelPrediction fcn
% 이 함수는 차량의 물리적 상태를 기반으로 순간 연료 소모율을 계산합니다.
%
% 입력 (Inputs):
%   v     - velocity (m/s), 차량의 현재 속도
%   a     - acceleration (m/s^2), 차량의 현재 가속도
%   theta - gradient of climb (rad), 도로의 경사도
%
% 출력 (Output):
%   FC    - Fuel Consumption Rate, 단위 시간당 연료 소모율

    %% 파라미터 정의 (차량 제원)
    rho = 1.2256;       % 공기 밀도 (kg/m^3)
    Cd = 0.615;         % 공기 저항 계수
    Ch = 1-0.085 * 0;   % 고도 보정 계수
    Af = 10.2;          % 차량 전면 면적 (m^2)
    Cr = 1.25;          % 구름 저항 계수
    c1 = 0.0328;        % 구름 저항 속도 계수 1
    c2 = 4.575;         % 구름 저항 속도 계수 2
    mass = 23000;       % 차량 총 중량 (kg)
    eta_d = 0.85;       % 동력 전달 효율
    
    %% 1. 주행 저항력 계산
    % 차량에 작용하는 세 가지 주요 저항력을 계산합니다.
    R_drag = (rho/25.92) * Cd * Ch * Af .* v .^(2); % 공기 저항
    R_roll = 9.81 * (Cr/1000)*(c1.*v + c2);         % 구름 저항
    R_clm  = 9.81 * mass .* sin(theta);            % 등판 저항
    R = R_drag + R_roll + R_clm; % 총 주행 저항
    
    %% 2. 차량 필요 출력(Power) 계산
    % 총 주행 저항을 이겨내고 목표 가속도를 내기 위해 필요한 출력을 계산합니다.
    P = ((R + 1.04 * mass.*a) / (3600*eta_d)) .* v; 
    
    %% 3. 출력-연료 소모 변환 모델
    % 실험 데이터 기반의 2차 다항식을 사용하여 출력을 연료 소모율로 변환합니다.
    a0 = 0.7607578263;
    a1 = 0.0336310284;
    a2 = 0.0000630368;
    
    FC_raw = a0  + a1 * P + a2  * P^(2);
    
    % 최종 스케일링
    FC = FC_raw / 850;
end
2.4.3. 모델 상세입력: v (속도, m/s), a (가속도, m/s²), theta (도로 경사도, rad).출력: FC (단위 시간당 연료 소모율).계산 로직:주행 저항력 계산: 차량에 작용하는 물리적 힘인 공기 저항, 구름 저항, 등판 저항을 각각 계산하여 합산한다.차량 출력 계산: 주행 저항을 이겨내고 목표 가속도를 달성하는 데 필요한 엔진의 출력(Power)을 계산한다.연료 소모율 변환: 계산된 출력을 기반으로, 실험적으로 도출된 2차 다항식 모델에 대입하여 최종 연료 소모율을 산출한다.3. 데이터 흐름 및 자료구조3.1. 데이터 흐름도sequenceDiagram
    participant V as 차량/센서
    participant R as RHC Supervisor
    participant F as fcn_stateless
    participant D as velocityOptimiz_DP
    participant Fuel as fuel_prediction_model
    participant C as 차량 제어기

    loop 매 시뮬레이션 스텝
        V->>R: 현재 상태 (위치, 속도, SPaT)
        R->>R: 호라이즌 업데이트 (K, K+1 결정)
        R->>R: 최적화 버퍼(OB) 구성
        R->>F: K, K+1 초기 신호 정보 전달
        F-->>R: 미래 신호 스케줄 반환
        R->>D: 최적화 버퍼(OB) 전달
        D->>Fuel: (반복) 속도 프로파일 후보 전달
        Fuel-->>D: (반복) 연료 소모율 반환
        D-->>R: 최적 궤적 파라미터 반환
        R->>C: 현재 시점 목표 속도(v_set) 전달
    end
